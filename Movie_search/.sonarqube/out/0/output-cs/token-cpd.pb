®
BC:\progs\Movie_search\Movie_search\Controllers\SearchController.cs
	namespace

 	
Movie_search


 
.

 
Controllers

 "
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
SearchController !
:" #
ControllerBase$ 2
{ 
private 

IMDBReader 
reader !
=" #
new$ '

IMDBReader( 2
(2 3
)3 4
;4 5
[ 	
HttpGet	 
] 
public 
IEnumerable 
< 
string !
>! "
Get# &
(& '
)' (
{ 	
return 
new 
string 
[ 
] 
{  !
$str" *
,* +
$str, 4
}5 6
;6 7
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
List 
< 
Movie 
> 
GetMovieByTitle *
(* +
string+ 1
title2 7
)7 8
{ 	
if 
( 
title 
. 
Length 
< 
$num  
)  !
return 
null 
; 
else 
return 
reader 
. 
FindByTitle )
() *
title* /
)/ 0
;0 1
} 	
[!! 	
HttpGet!!	 
(!! 
$str!!  
)!!  !
]!!! "
public"" 
Movie"" 
GetExtendedInfoByID"" (
(""( )
string"") /
id""0 2
)""2 3
{## 	
if$$ 
($$ 
id$$ 
.$$ 

StartsWith$$ 
($$ 
$str$$ !
)$$! "
)$$" #
return%% 
reader%% 
.%% 
ExtendedInfoByID%% .
(%%. /
id%%/ 1
)%%1 2
;%%2 3
else&& 
return'' 
null'' 
;'' 
}(( 	
})) 
}** ™1
6C:\progs\Movie_search\Movie_search\Logic\IMDBReader.cs
	namespace 	
Movie_search
 
. 
Logic 
{ 
public 

class 

IMDBReader 
{ 
private 
const 
string 
URL  
=! "
$str# A
;A B
private 
const 
string 
key  
=! "
$str# 0
;0 1
private 
const 
string 
search #
=$ %
$str& 4
;4 5
private 
const 
string 
title "
=# $
$str% -
;- .
private 
const 
string 
trailer $
=% &
$str' 8
;8 9
private 

HttpClient 
client !
=" #
new$ '

HttpClient( 2
(2 3
)3 4
;4 5
public 

IMDBReader 
( 
) 
{ 	
client 
. 
BaseAddress 
=  
new! $
Uri% (
(( )
URL) ,
), -
;- .
client 
. !
DefaultRequestHeaders (
.( )
Accept) /
./ 0
Add0 3
(3 4
new +
MediaTypeWithQualityHeaderValue 3
(3 4
$str4 F
)F G
)G H
;H I
} 	
public 
List 
< 
Movie 
> 
FindByTitle &
(& '
string' -
title. 3
)3 4
{   	
HttpResponseMessage!! 
response!!  (
=!!) *
client!!+ 1
.!!1 2
GetAsync!!2 :
(!!: ;
search!!; A
+!!A B
key!!B E
+!!E F
title!!F K
)!!K L
.!!L M
Result!!M S
;!!S T
if"" 
("" 
response"" 
."" 
IsSuccessStatusCode"" ,
)"", -
{## 
JObject&& 

jsonString&& "
=&&# $
Parse&&% *
(&&* +
response&&+ 3
)&&3 4
;&&4 5
List'' 
<'' 
Movie'' 
>'' 
movies'' "
=''# $
new''% (
List'') -
<''- .
Movie''. 3
>''3 4
(''4 5
)''5 6
;''6 7
foreach(( 
((( 
var(( 
movie(( "
in((# %

jsonString((& 0
.((0 1
SelectToken((1 <
(((< =
$str((= F
)((F G
)((G H
{)) 
movies** 
.** 
Add** 
(** 
JsonSerializer** -
.**- .
Deserialize**. 9
<**9 :
Movie**: ?
>**? @
(**@ A
movie**A F
.**F G
ToString**G O
(**O P
)**P Q
)**Q R
)**R S
;**S T
}++ 
return,, 
movies,, 
;,, 
}-- 
else.. 
{// 
return00 
null00 
;00 
}11 
}33 	
public44 
Movie44 
ExtendedInfoByID44 %
(44% &
string44& ,
id44- /
)44/ 0
{55 	
Movie66 
movie66 
;66 
HttpResponseMessage77 
response77  (
=77) *
client77+ 1
.771 2
GetAsync772 :
(77: ;
title77; @
+77A B
key77C F
+77G H
id77I K
+77L M
$str77N Y
)77Y Z
.77Z [
Result77[ a
;77a b
if88 
(88 
response88 
.88 
IsSuccessStatusCode88 ,
)88, -
{99 
movie<< 
=<< 
JsonSerializer<< &
.<<& '
Deserialize<<' 2
<<<2 3
Movie<<3 8
><<8 9
(<<9 :
Parse<<: ?
(<<? @
response<<@ H
)<<H I
.<<I J
ToString<<J R
(<<R S
)<<S T
)<<T U
;<<U V
}== 
else>> 
{?? 
return@@ 
null@@ 
;@@ 
}AA 
responseBB 
=BB 
clientBB 
.BB 
GetAsyncBB &
(BB& '
trailerBB' .
+BB/ 0
keyBB1 4
+BB5 6
idBB7 9
)BB9 :
.BB: ;
ResultBB; A
;BBA B
ifCC 
(CC 
responseCC 
.CC 
IsSuccessStatusCodeCC ,
)CC, -
{DD 
varEE 
dataObjectsEE 
=EE  !
responseEE" *
.EE* +
ContentEE+ 2
.EE2 3
ReadAsStringAsyncEE3 D
(EED E
)EEE F
.EEF G
ResultEEG M
;EEM N
JObjectFF 

jsonStringFF "
=FF# $
JObjectFF% ,
.FF, -
ParseFF- 2
(FF2 3
dataObjectsFF3 >
)FF> ?
;FF? @
movieGG 
.GG 
videoUrlGG 
=GG  

jsonStringGG! +
.GG+ ,
SelectTokenGG, 7
(GG7 8
$strGG8 B
)GGB C
.GGC D
ToStringGGD L
(GGL M
)GGM N
;GGN O
returnHH 
movieHH 
;HH 
}II 
elseJJ 
{KK 
returnLL 
nullLL 
;LL 
}MM 
}NN 	
privateOO 
JObjectOO 
ParseOO 
(OO 
HttpResponseMessageOO 1
responseOO2 :
)OO: ;
{PP 	
varQQ 
dataObjectsQQ 
=QQ 
responseQQ &
.QQ& '
ContentQQ' .
.QQ. /
ReadAsStringAsyncQQ/ @
(QQ@ A
)QQA B
.QQB C
ResultQQC I
;QQI J
returnRR 
JObjectRR 
.RR 
ParseRR  
(RR  !
dataObjectsRR! ,
)RR, -
;RR- .
}SS 	
}TT 
}UU ê	
1C:\progs\Movie_search\Movie_search\Model\Movie.cs
	namespace 	
Movie_search
 
. 
Model 
{ 
public 

class 
Movie 
{		 
public

 
string

 
title

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
videoUrl 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
id 
{ 
get 
; 
set  #
;# $
}% &
public 
string 

imDbRating  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
plot 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
image 
{ 
get !
;! "
set# &
;& '
}( )
} 
} á

-C:\progs\Movie_search\Movie_search\Program.cs
	namespace

 	
Movie_search


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} Œ
-C:\progs\Movie_search\Movie_search\Startup.cs
	namespace 	
Movie_search
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddControllers #
(# $
)$ %
;% &
} 	
public   
void   
	Configure   
(   
IApplicationBuilder   1
app  2 5
,  5 6
IWebHostEnvironment  7 J
env  K N
)  N O
{!! 	
if"" 
("" 
env"" 
."" 
IsDevelopment"" !
(""! "
)""" #
)""# $
{## 
app$$ 
.$$ %
UseDeveloperExceptionPage$$ -
($$- .
)$$. /
;$$/ 0
}%% 
app'' 
.'' 
UseHttpsRedirection'' #
(''# $
)''$ %
;''% &
app)) 
.)) 

UseRouting)) 
()) 
))) 
;)) 
app++ 
.++ 
UseAuthorization++  
(++  !
)++! "
;++" #
app-- 
.-- 
UseEndpoints-- 
(-- 
	endpoints-- &
=>--' )
{.. 
	endpoints// 
.// 
MapControllers// (
(//( )
)//) *
;//* +
}00 
)00 
;00 
}11 	
}22 
}33 